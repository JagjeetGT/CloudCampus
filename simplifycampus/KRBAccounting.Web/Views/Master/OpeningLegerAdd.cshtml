@using KRBAccounting.Data.Repositories
@using KRBAccounting.Domain.Entities
@using KRBAccounting.Service
@model KRBAccounting.Web.ViewModels.Master.OpeningLedgerAddViewModel
<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
<div id="MsgError">
</div>
<div>
    <div class="clearfix">
    </div>
    <!--Tabs-->
    <div id="tabs" style="width: 1090px;">
        <ul>
            <li><a href="#tabs-1">Customer</a></li>
            <li><a href="#tabs-2">Vendor</a></li>
            <li><a href="#tabs-3">Both</a></li>
            <li><a href="#tabs-4">Other</a></li>
        </ul>
        <!--Tab one-->
        <div id="tabs-1">
            @using (Ajax.BeginForm("OpeningLegerAddCustomer", "Master", new { Controller = "Master" }, new AjaxOptions { UpdateTargetId = "MsgError", OnSuccess = "sucess", HttpMethod = "POST" }, new { @class = "form-custom", id = "OpeningLegdercustomer-form" }))
            {
                <fieldset>
                    <div class="lag activity_detail">
                        <table class="table-bordered" id="openingledgerCustomer-list">
                            <tr class="nodrop nodrag">
                                <th>
                                </th>
                                <th>
                                    Ledger
                                </th>
                                <th>
                                    Sub Ledger
                                </th>
                                <th>
                                    Amount Type
                                </th>
                                <th>
                                    Opening Balance
                                </th>
                                <th>
                                </th>
                            </tr>
                            @foreach (var item in Model.CustomerOpenings)
                            {

                                item.AmountTypeList = new SelectList(Model.AmountType, "Value", "Text", item.AmountType);
                                @Html.Partial("PartialOpeningLedgerAdd", item)
                            }
                            @{
                            var model = new OpeningLedger();
                            model.AmountTypeList = Model.AmountType; 
    
                                @Html.Partial("PartialOpeningLedgerAdd", model)
                                    
                            }
                        </table>
                        <div class="clear">
                        </div>
                        <input type="button" value="Save" class="btn customeropening" style="margin-top: 10px; margin-left: 3px;" />
                    </div>
                </fieldset>
            }
        </div>
        <div id="tabs-2">
            @using (Ajax.BeginForm("OpeningLegerAddVendor", "Master", new { Controller = "Master" }, new AjaxOptions { UpdateTargetId = "MsgError", OnSuccess = "sucess", HttpMethod = "POST" }, new { @class = "form-custom", id = "OpeningLegdervendor-form" }))
            {
                <fieldset>
                    <div class="lag activity_detail">
                        <table class="table-bordered" id="openingledgervendor-list">
                            <tr class="nodrop nodrag">
                                <th>
                                </th>
                                <th>
                                    Ledger
                                </th>
                                <th>
                                    Sub Ledger
                                </th>
                                <th>
                                    Amount Type
                                </th>
                                <th>
                                    Opening Balance
                                </th>
                                <th>
                                </th>
                            </tr>
                            @foreach (var item in Model.VendorOpenings)
                            {
                                item.AmountTypeList = new SelectList(Model.AmountType, "Value", "Text", item.AmountType);
                                @Html.Partial("PartialOpeningVendorAdd", item)
                            }
                            @{
                            var model = new OpeningLedger();
                            model.AmountTypeList = Model.AmountType; 
    
                                @Html.Partial("PartialOpeningVendorAdd", model)
                                    
                            }
                        </table>
                        <div class="clear">
                        </div>
                        <input type="button" value="Save" class="btn vendorOpening" style="margin-top: 10px; margin-left: 3px;" />
                    </div>
                </fieldset>
            }
        </div>
        <div id="tabs-3">
            @using (Ajax.BeginForm("OpeningLegerAddBoth", "Master", new { Controller = "Master" }, new AjaxOptions { UpdateTargetId = "MsgError", OnSuccess = "sucess", HttpMethod = "POST" }, new { @class = "form-custom", id = "OpeningLegderboth-form" }))
            {
                <fieldset>
                    <div class="lag activity_detail">
                        <table class="table-bordered" id="openingledgerboth-list">
                            <tr class="nodrop nodrag">
                                <th>
                                </th>
                                <th>
                                    Ledger
                                </th>
                                <th>
                                    Sub Ledger
                                </th>
                                <th>
                                    Amount Type
                                </th>
                                <th>
                                    Opening Balance
                                </th>
                                <th>
                                </th>
                            </tr>
                            @foreach (var item in Model.BothOpenings)
                            {
                                item.AmountTypeList = new SelectList(Model.AmountType, "Value", "Text", item.AmountType);
                                @Html.Partial("PartialOpeningBothAdd", item)
                            }
                            @{
                            var model = new OpeningLedger();
                            model.AmountTypeList = Model.AmountType; 
    
                                @Html.Partial("PartialOpeningBothAdd", model)
                                    
                            }
                        </table>
                        <div class="clear">
                        </div>
                        <input type="button" value="Save" class="btn bothOpening" style="margin-top: 10px; margin-left: 3px;" />
                    </div>
                </fieldset>
            }
        </div>
        <div id="tabs-4">
            @using (Ajax.BeginForm("OpeningLegerAddOther", "Master", new { Controller = "Master" }, new AjaxOptions { UpdateTargetId = "MsgError", OnSuccess = "sucess", HttpMethod = "POST" }, new { @class = "form-custom", id = "OpeningLegderother-form" }))
            {
                <fieldset>
                    <div class="lag activity_detail">
                        <table class="table-bordered" id="openingledgerother-list">
                            <tr class="nodrop nodrag">
                                <th>
                                </th>
                                <th>
                                    Ledger
                                </th>
                                <th>
                                    Sub Ledger
                                </th>
                                <th>
                                    Amount Type
                                </th>
                                <th>
                                    Opening Balance
                                </th>
                                <th>
                                </th>
                            </tr>
                            @foreach (var item in Model.OtherOpenings)
                            {
                                item.AmountTypeList = new SelectList(Model.AmountType, "Value", "Text", item.AmountType);
                                @Html.Partial("PartialOpeningOtherAdd", item)
                            }
                            @{
                            var model = new OpeningLedger();
                            model.AmountTypeList = Model.AmountType; 
    
                                @Html.Partial("PartialOpeningOtherAdd", model)
                                    
                            }
                        </table>
                        <div class="clear">
                        </div>
                        <input type="button" value="Save" class="btn otherOpening" style="margin-top: 10px; margin-left: 3px;" />
                    </div>
                </fieldset>
            }
        </div>
    </div>
    <div class="clearfix">
    </div>
</div>
<style>
    .selectedli
    {
        background-color: #A9A9A9;
        text-decoration: none;
    }
    .ledgerList
    {
        border: 1px solid;
        height: 240px;
        margin-right: 10px;
        overflow-y: scroll;
        width: 200px;
    }
</style>
<script type="text/javascript">
    $(document).ready(function () {
        $("#tabs").tabs();


        var textproblem = document.querySelectorAll(".text_ledger");
        $.each(textproblem, function (index) {
            var element = $(this);
            var closestTr = element.closest("tr");
            closestTr.attr("id", "tr_" + index);

            var problemId = closestTr.find(".ledger_opening").attr("id");

            closestTr.find(".text_ledger").attr({
                valueid: problemId,
                id: "text_ledger_" + index
            });

            var value = closestTr.find(".ledger_opening").val();
            if(value!=0) {
                closestTr.addClass("deletable");
            }

        });

        var customerSubLedger = document.querySelectorAll(".text_subledger");
        $.each(customerSubLedger, function (index) {
            var element = $(this);
            var closestTr = element.closest("tr");

            var problemId = closestTr.find(".sub-ledger_openingCustomer").attr("id");

            closestTr.find(".text_subledger").attr({
                valueid: problemId,
                id: "text_subledger_" + index
            });

            var value = closestTr.find(".sub-ledger_openingCustomer").val();
            if (value != 0) {
                closestTr.addClass("deletable");
            }

        });


        

        var textproblemvendor = document.querySelectorAll(".text_ledger_vendor");
        $.each(textproblemvendor, function (index) {
            var element = $(this);
            var closestTr = element.closest("tr");
            closestTr.attr("id", "tr_" + index);

            var problemId = closestTr.find(".ledger_openingvendor").attr("id");

            closestTr.find(".text_ledger_vendor").attr({
                valueid: problemId,
                id: "text_ledger_vendor_" + index
            });
            var value = closestTr.find(".ledger_openingvendor").val();
            if (value != 0) {
                closestTr.addClass("deletable");
            }
        });

        var vendorSubLedger = document.querySelectorAll(".text_subledger_vendor");
        $.each(vendorSubLedger, function (index) {
            var element = $(this);
            var closestTr = element.closest("tr");

            var problemId = closestTr.find(".sub-ledger_openingVendor").attr("id");

            closestTr.find(".text_subledger_vendor").attr({
                valueid: problemId,
                id: "text_subledger_vendor_" + index
            });

            var value = closestTr.find(".sub-ledger_openingVendor").val();
            if (value != 0) {
                closestTr.addClass("deletable");
            }

        });


        var bothSubLedger = document.querySelectorAll(".text_subledger_both");
        $.each(bothSubLedger, function (index) {
            var element = $(this);
            var closestTr = element.closest("tr");

            var problemId = closestTr.find(".sub-ledger_openingBoth").attr("id");

            closestTr.find(".text_subledger_both").attr({
                valueid: problemId,
                id: "text_subledger_both_" + index
            });

            var value = closestTr.find(".sub-ledger_openingBoth").val();
            if (value != 0) {
                closestTr.addClass("deletable");
            }

        });


        var otherSubLedger = document.querySelectorAll(".text_subledger_other");
        $.each(otherSubLedger, function (index) {
            var element = $(this);
            var closestTr = element.closest("tr");

            var problemId = closestTr.find(".sub-ledger_openingOther").attr("id");

            closestTr.find(".text_subledger_other").attr({
                valueid: problemId,
                id: "text_subledger_other_" + index
            });

            var value = closestTr.find(".sub-ledger_openingOther").val();
            if (value != 0) {
                closestTr.addClass("deletable");
            }

        });



        var textproblemboth = document.querySelectorAll(".text_ledger_both");
        $.each(textproblemboth, function (index) {
            var element = $(this);
            var closestTr = element.closest("tr");
            closestTr.attr("id", "tr_" + index);

            var problemId = closestTr.find(".ledger_opening_both").attr("id");

            closestTr.find(".text_ledger_both").attr({
                valueid: problemId,
                id: "text_ledger_both_" + index
            });
            var value = closestTr.find(".ledger_opening_both").val();
            if (value != 0) {
                closestTr.addClass("deletable");
            }
        });

        var textproblemother = document.querySelectorAll(".text_ledger_other");
        $.each(textproblemother, function (index) {
            var element = $(this);
            var closestTr = element.closest("tr");
            closestTr.attr("id", "tr_" + index);

            var problemId = closestTr.find(".ledger_opening_other").attr("id");

            closestTr.find(".text_ledger_other").attr({
                valueid: problemId,
                id: "text_ledger_other_" + index
            });
            var value = closestTr.find(".ledger_opening_other").val();
            if (value != 0) {
                closestTr.addClass("deletable");
            }
        });

    });


    function NewRowDetailList(element, index) {
        var closestTable = element.closest("table");
        //alert(closestTable.html());
        //element.closest("tr").attr("id", "tr_" + index);

        var problemId = $(".ledger_opening:last").attr("id");
        $(closestTable).find(".text_ledger:last").attr({
            valueid: problemId,
            id: "text_ledger_" + index
        });

        var subledgerId = $(".sub-ledger_openingCustomer:last").attr("id");
        $(closestTable).find(".text_subledger:last").attr({
            valueid: subledgerId,
            id: "text_subledger_" + index
        });

        var vendorId = $(".ledger_openingvendor:last").attr("id");
        $(closestTable).find(".text_ledger_vendor:last").attr({
            valueid: vendorId,
            id: "text_ledger_vendor_" + index
        });

        var subledgerVendorId = $(".sub-ledger_openingVendor:last").attr("id");
        $(closestTable).find(".text_subledger_vendor:last").attr({
            valueid: subledgerVendorId,
            id: "text_subledger_vendor_" + index
        });

        var subledgerBothId = $(".sub-ledger_openingBoth:last").attr("id");
        $(closestTable).find(".text_subledger_both:last").attr({
            valueid: subledgerBothId,
            id: "text_subledger_both_" + index
        });

        var subledgerothersId = $(".sub-ledger_openingOther:last").attr("id");
        $(closestTable).find(".text_subledger_other:last").attr({
            valueid: subledgerothersId,
            id: "text_subledger_other_" + index
        });

        var bothId = $(".ledger_opening_both:last").attr("id");
        $(closestTable).find(".text_ledger_both:last").attr({
            valueid: bothId,
            id: "text_ledger_both_" + index
        });

        var otherId = $(".ledger_opening_other:last").attr("id");
        $(closestTable).find(".text_ledger_other:last").attr({
            valueid: otherId,
            id: "text_ledger_other_" + index
        });
    }

    $(".del-row").live("click", function () {
        $(this).closest("tr").remove();
    });

    $(".otherOpening").live("click", function () {
        $.blockUI({
            message: 'Please Wait..',
            css: {
                border: 'none',
                padding: '15px',
                backgroundColor: '#fff',
                '-webkit-border-radius': '10px',
                '-moz-border-radius': '10px',
                color: '#000'
            }
        });
        $("#OpeningLegderother-form").submit();
    });

    $(".bothOpening").live("click", function () {
        $.blockUI({
            message: 'Please Wait..',
            css: {
                border: 'none',
                padding: '15px',
                backgroundColor: '#fff',
                '-webkit-border-radius': '10px',
                '-moz-border-radius': '10px',
                color: '#000'
            }
        });
        $("#OpeningLegderboth-form").submit();
    });

    $(".vendorOpening").live("click", function () {
        $.blockUI({
            message: 'Please Wait..',
            css: {
                border: 'none',
                padding: '15px',
                backgroundColor: '#fff',
                '-webkit-border-radius': '10px',
                '-moz-border-radius': '10px',
                color: '#000'
            }
        });
        $("#OpeningLegdervendor-form").submit();
    });

    $(".customeropening").live("click", function () {
        $.blockUI({
            message: 'Please Wait..',
            css: {
                border: 'none',
                padding: '15px',
                backgroundColor: '#fff',
                '-webkit-border-radius': '10px',
                '-moz-border-radius': '10px',
                color: '#000'
            }
        });
        $("#OpeningLegdercustomer-form").submit();
    });

    
</script>
