
@model KRBAccounting.Web.ViewModels.LedgerReport.ProfitAndLossReportNormalViewModel
@{
    var incomeHeaders = KRBAccounting.Service.UtilityService.GetProfitAndLossHeaders(Model.AsOnDate, null, "I", Model.FYId, Model.BranchId);
    var expenditureHeaders = KRBAccounting.Service.UtilityService.GetProfitAndLossHeaders(Model.AsOnDate, null, "E", Model.FYId, Model.BranchId);
    decimal incomeTotal = incomeHeaders.Where(x => x.ASGId == 0 && x.ASGName == null).Sum(x => x.Total);
    decimal expenditureTotal = expenditureHeaders.Where(x => x.ASGId == 0 && x.ASGName == null).Sum(x => x.Total);
    var profitLoss = incomeTotal - expenditureTotal;
    var incomeGrandTotal = incomeTotal;
    var expenditureGrandTotal = expenditureTotal;
}
<link rel="stylesheet" type="text/css" media="print" href="/Content/Style.css" />
<link rel="stylesheet" type="text/css" media="print" href="/Content/bootstrap/css/bootstrap.css" />
<div class="clearfix">
</div>
<div class="ReportHeader" style="text-align: center">
    @Html.Partial("_PartialReportHeader", Model.ReportHeader)
</div>
<div class="ReportList">
    <table class="table" cellspacing="0" cellpadding="0" width="100%">
        @if (Model.AccountGroup == true && Model.Ledger == true)
        {
            if (Model.AccountSubGroup == false && Model.Subledger == false)
            {
                <thead>
                    <tr>
                        <th>
                            Expenses  
                        </th>
                        <th>
                            Ledger Total
                        </th>
                        <th>
                            Group Total
                        </th>
                        <th>
                            Income
                        </th>
                        <th>
                            Ledger Total
                        </th>
                        <th>
                            Group Total
                        </th>
                    </tr>
                </thead>
                <tr>
                    <td colspan="3">
                        <table class="listpopup" cellspacing="0" cellpadding="0" width="100%">
                            @foreach (var EItem in expenditureHeaders.Where(x => x.ASGId == 0 && x.ASGName == null))
                            {
                                <tr>
                                    <td style="font-weight: bold">
                                        @EItem.Description
                                    </td>
                                    <td>
                                    </td>
                                    <td style="text-align: right; font-weight: bold">@EItem.Total
                                    </td>
                                </tr>

                                var expenditureLedgers = KRBAccounting.Service.UtilityService.GetProfitAndLossLedgerTotals(Model.AsOnDate, "E", EItem.Id, 0, 0, Model.FYId, 0, 0, Model.BranchId);
                                foreach (var Eledger in expenditureLedgers)
                                {
                                    <tr>
                                        <td style="padding-left: 30px">
                                            @Eledger.AccountName
                                        </td>
                                        <td style="text-align: right">@Eledger.Total
                                        </td>
                                        <td>
                                        </td>
                                    </tr>
                                }
                            }
                        </table>
                    </td>
                    <td colspan="3">
                        <table class="listpopup" cellspacing="0" cellpadding="0" width="100%">
                            @foreach (var IItem in incomeHeaders.Where(x => x.ASGId == 0 && x.ASGName == null))
                            {
                                <tr>
                                    <td style="font-weight: bold">
                                        @IItem.Description
                                    </td>
                                    <td>
                                    </td>
                                    <td style="text-align: right; font-weight: bold">@IItem.Total
                                    </td>
                                </tr>
                                var incomeLedgers = KRBAccounting.Service.UtilityService.GetProfitAndLossLedgerTotals(Model.AsOnDate, "I", IItem.Id, 0, 0, Model.FYId, 0, 0, Model.BranchId);
                                foreach (var Iledger in incomeLedgers)
                                {
                                    <tr>
                                        <td style="padding-left: 30px">
                                            @Iledger.AccountName
                                        </td>
                                        <td style="text-align: right">@Iledger.Total
                                        </td>
                                        <td>
                                        </td>
                                    </tr>
                                }
                            }
                        </table>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: right; font-weight: bold">
                        TOTAL FOR EXPENDITURE SIDE
                    </td>
                    <td>
                    </td>
                    <td style="text-align: right; font-weight: bold">@expenditureTotal
                    </td>
                    <td style="text-align: right; font-weight: bold">
                        TOTAL FOR INCOME 
                    </td>
                    <td>
                    </td>
                    <td style="text-align: right; font-weight: bold">@incomeTotal
                    </td>
                </tr>
                            if (profitLoss > 0)
                            {
                                expenditureGrandTotal = expenditureTotal + profitLoss;
                    <tr>
                        <td style="text-align: right; font-weight: bold">
                            Net Profit C/F To B/S
                        </td>
                        <td>
                        </td>
                        <td style="text-align: right; font-weight: bold">@profitLoss
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td >
                        </td>
                    </tr>
                            }
                            if (profitLoss < 0)
                            {
                                var absProfitLoss = Math.Abs(profitLoss);
                                incomeGrandTotal = incomeTotal + absProfitLoss;
                    <tr>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td >
                        </td>
                        <td style="text-align: right; font-weight: bold">
                            Net Loss C/F To B/S
                        </td>
                        <td>
                        </td>
                        <td style="text-align: right; font-weight: bold">@profitLoss
                        </td>
                    </tr>
                            }
                <tr>
                    <td style="text-align: right; font-weight: bold">
                        GRAND TOTAL
                    </td>
                    <td>
                    </td>
                    <td style="text-align: right; font-weight: bold">@expenditureGrandTotal
                    </td>
                    <td style="text-align: right; font-weight: bold">
                        GRAND TOTAL
                    </td>
                    <td>
                    </td>
                    <td style="text-align: right; font-weight: bold">@incomeGrandTotal
                    </td>
                </tr>
            }
            if (Model.AccountSubGroup == true && Model.Subledger == false)
            {
                <thead>
                    <tr>
                        <th>
                            Expenses  
                        </th>
                        <th>
                            Ledger Total
                        </th>
                        <th>
                            Sub Group Total
                        </th>
                        <th>
                            Group Total
                        </th>
                        <th>
                            Income
                        </th>
                        <th>
                            Ledger Total
                        </th>
                        <th>
                            Sub Group Total
                        </th>
                        <th>
                            Group Total
                        </th>
                    </tr>
                </thead>
                <tr>
                    <td colspan="4">
                        <table class="listpopup" cellspacing="0" cellpadding="0" width="100%">
                            @foreach (var EItem in expenditureHeaders.Where(x => x.ASGId == 0 && x.ASGName == null))
                            {
                                <tr>
                                    <td style="font-weight: bold">
                                        @EItem.Description
                                    </td>
                                    <td>
                                    </td>
                                     <td>
                                    </td>
                                    <td style="text-align: right; font-weight: bold">@EItem.Total
                                    </td>
                                </tr>
                                foreach (var ESubItem in expenditureHeaders.Where(x => x.Id == EItem.Id && x.ASGName != null))
                                {
                                    <tr>
                                        <td style="padding-left: 30px; font-weight: bold">
                                            @ESubItem.ASGName
                                        </td>
                                        <td>
                                        </td>
                                        <td style="text-align: right; font-weight: bold">@ESubItem.Total
                                        </td>
                                        <td>
                                        </td>
                                    </tr>
                                    var expenditureLedgers = KRBAccounting.Service.UtilityService.GetProfitAndLossLedgerTotals(Model.AsOnDate, "E", ESubItem.Id, ESubItem.ASGId, 0, Model.FYId, 1, 0, Model.BranchId);
                                    foreach (var Eledger in expenditureLedgers)
                                    {
                                        <tr>
                                            <td style="padding-left: 45px">
                                                @Eledger.AccountName
                                            </td>
                                            <td style="text-align: right">@Eledger.Total
                                            </td>
                                            <td>
                                            </td>
                                            <td>
                                            </td>
                                        </tr>
                                    }
                                }
                            }
                        </table>
                    </td>
                    <td colspan="4">
                        <table class="listpopup" cellspacing="0" cellpadding="0" width="100%">
                            @foreach (var IItem in incomeHeaders.Where(x => x.ASGId == 0 && x.ASGName == null))
                            {
                                <tr>
                                    <td style="font-weight: bold">
                                        @IItem.Description
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                    </td>
                                    <td style="text-align: right; font-weight: bold">@IItem.Total
                                    </td>
                                </tr>
                                foreach (var ISubItem in incomeHeaders.Where(x => x.Id == IItem.Id && x.ASGName != null))
                                {
                                    <tr>
                                        <td style="padding-left: 30px; font-weight: bold">
                                            @ISubItem.ASGName
                                        </td>
                                        <td>
                                        </td>
                                        <td style="text-align: right; font-weight: bold">@ISubItem.Total
                                        </td>
                                        <td>
                                        </td>
                                    </tr>
                                    var incomeLedgers = KRBAccounting.Service.UtilityService.GetProfitAndLossLedgerTotals(Model.AsOnDate, "I", ISubItem.Id, ISubItem.ASGId, 0, Model.FYId, 0, 0, Model.BranchId);
                                    foreach (var Iledger in incomeLedgers)
                                    {
                                        <tr>
                                            <td style="padding-left: 45px">
                                                @Iledger.AccountName
                                            </td>
                                            <td style="text-align: right">@Iledger.Total
                                            </td>
                                            <td>
                                            </td>
                                            <td>
                                            </td>
                                        </tr>
                                    }
                                }
                            }
                        </table>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: right; font-weight: bold">
                        TOTAL FOR EXPENDITURE SIDE
                    </td>
                    <td>
                    </td>
                    <td>
                    </td>
                    <td style="text-align: right; font-weight: bold">@expenditureTotal
                    </td>
                    <td style="text-align: right; font-weight: bold">
                        TOTAL FOR INCOME 
                    </td>
                    <td>
                    </td>
                    <td>
                    </td>
                    <td style="text-align: right; font-weight: bold">@incomeTotal
                    </td>
                </tr>
                            if (profitLoss > 0)
                            {
                                expenditureGrandTotal = expenditureTotal + profitLoss;
                    <tr>
                        <td style="text-align: right; font-weight: bold">
                            Net Profit C/F To B/S
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td style="text-align: right; font-weight: bold">@profitLoss
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td >
                        </td>
                        <td>
                        </td>
                    </tr>
                            }
                            if (profitLoss < 0)
                            {
                                var absProfitLoss = Math.Abs(profitLoss);
                                incomeGrandTotal = incomeTotal + absProfitLoss;
                    <tr>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td >
                        </td>
                        <td>
                        </td>
                        <td style="text-align: right; font-weight: bold">
                            Net Loss C/F To B/S
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td style="text-align: right; font-weight: bold">@profitLoss
                        </td>
                    </tr>
                            }
                <tr>
                    <td style="text-align: right; font-weight: bold">
                        GRAND TOTAL
                    </td>
                    <td>
                    </td>
                    <td>
                    </td>
                    <td style="text-align: right; font-weight: bold">@expenditureGrandTotal
                    </td>
                    <td style="text-align: right; font-weight: bold">
                        GRAND TOTAL
                    </td>
                    <td>
                    </td>
                    <td>
                    </td>
                    <td style="text-align: right; font-weight: bold">@incomeGrandTotal
                    </td>
                </tr>
            }
            if (Model.AccountSubGroup == false && Model.Subledger == true)
            {
                <thead>
                    <tr>
                        <th>
                            Expenses  
                        </th>
                        <th>
                           Sub Ledger Total
                        </th>
                        <th>
                            Ledger Total
                        </th>
                        <th>
                            Group Total
                        </th>
                        <th>
                            Income
                        </th>
                        <th>
                           Sub Ledger Total
                        </th>
                        <th>
                            Ledger Total
                        </th>
                        <th>
                            Group Total
                        </th>
                    </tr>
                </thead>
                <tr>
                    <td colspan="4">
                        <table class="listpopup" cellspacing="0" cellpadding="0" width="100%">
                            @foreach (var EItem in expenditureHeaders.Where(x => x.ASGId == 0 && x.ASGName == null))
                            {
                                <tr>
                                    <td style="font-weight: bold">
                                        @EItem.Description
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                    </td>
                                    <td style="text-align: right; font-weight: bold">@EItem.Total
                                    </td>
                                </tr>

                                var expenditureLedgers = KRBAccounting.Service.UtilityService.GetProfitAndLossLedgerTotals(Model.AsOnDate, "E", EItem.Id, 0, 0, Model.FYId, 0, 1, Model.BranchId);
                                foreach (var Eledger in expenditureLedgers)
                                {
                                    if (Eledger.SLName == null)
                                    {
                                        <tr>
                                            <td style="padding-left: 30px">
                                                @Eledger.AccountName
                                            </td>
                                            <td>
                                            </td>
                                            <td style="text-align: right">@Eledger.Total
                                            </td>
                                            <td>
                                            </td>
                                        </tr>
                                    }
                                    else if (Eledger.SLName != null)
                                    {
                                        <tr>
                                            <td style="padding-left: 45px">
                                                @Eledger.SLName
                                            </td>
                                            <td style="text-align: right">@Eledger.Total
                                            </td>
                                            <td>
                                            </td>
                                            <td>
                                        </td>
                                        </tr>
                                    }
                                }
                            }
                        </table>
                    </td>
                    <td colspan="4">
                        <table class="listpopup" cellspacing="0" cellpadding="0" width="100%">
                            @foreach (var IItem in incomeHeaders.Where(x => x.ASGId == 0 && x.ASGName == null))
                            {
                                <tr>
                                    <td style="font-weight: bold">
                                        @IItem.Description
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                    </td>
                                    <td style="text-align: right; font-weight: bold">@IItem.Total
                                    </td>
                                </tr>
                                var incomeLedgers = KRBAccounting.Service.UtilityService.GetProfitAndLossLedgerTotals(Model.AsOnDate, "I", IItem.Id, 0, 0, Model.FYId, 0, 1, Model.BranchId);
                                foreach (var Iledger in incomeLedgers)
                                {
                                    if (Iledger.SLName == null)
                                    {
                                        <tr>
                                            <td style="padding-left: 30px">
                                                @Iledger.AccountName
                                            </td>
                                            <td>
                                            </td>
                                            <td style="text-align: right">@Iledger.Total
                                            </td>
                                            <td>
                                            </td>
                                        </tr>
                                    }
                                    else if (Iledger.SLName != null)
                                    {
                                        <tr>
                                            <td style="padding-left: 45px">
                                                @Iledger.SLName
                                            </td>
                                            <td style="text-align: right">@Iledger.Total
                                            </td>
                                            <td>
                                            </td>
                                            <td>
                                        </td>
                                        </tr>
                                    }
                                }
                            }
                        </table>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: right; font-weight: bold">
                        TOTAL FOR EXPENDITURE SIDE
                    </td>
                    <td>
                    </td>
                    <td>
                    </td>
                    <td style="text-align: right; font-weight: bold">@expenditureTotal
                    </td>
                    <td style="text-align: right; font-weight: bold">
                        TOTAL FOR INCOME 
                    </td>
                    <td>
                    </td>
                    <td>
                    </td>
                    <td style="text-align: right; font-weight: bold">@incomeTotal
                    </td>
                </tr>
                            if (profitLoss > 0)
                            {
                                expenditureGrandTotal = expenditureTotal + profitLoss;
                    <tr>
                        <td style="text-align: right; font-weight: bold">
                            Net Profit C/F To B/S
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td style="text-align: right; font-weight: bold">@profitLoss
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td >
                        </td>
                        <td>
                    </td>
                    </tr>
                            }
                            if (profitLoss < 0)
                            {
                                var absProfitLoss = Math.Abs(profitLoss);
                                incomeGrandTotal = incomeTotal + absProfitLoss;
                    <tr>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td >
                        </td>
                        <td>
                        </td>
                        <td style="text-align: right; font-weight: bold">
                            Net Loss C/F To B/S
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td style="text-align: right; font-weight: bold">@profitLoss
                        </td>
                    </tr>
                            }
                <tr>
                    <td style="text-align: right; font-weight: bold">
                        GRAND TOTAL
                    </td>
                    <td>
                    </td>
                    <td>
                    </td>
                    <td style="text-align: right; font-weight: bold">@expenditureGrandTotal
                    </td>
                    <td style="text-align: right; font-weight: bold">
                        GRAND TOTAL
                    </td>
                    <td>
                    </td>
                    <td>
                    </td>
                    <td style="text-align: right; font-weight: bold">@incomeGrandTotal
                    </td>
                </tr>
            }
            if (Model.AccountSubGroup == true && Model.Subledger == true)
            {
                <thead>
                    <tr>
                        <th>
                            Expenses  
                        </th>
                        <th>
                            Sub Ledger Total
                        </th>
                        <th>
                            Ledger Total
                        </th>
                        <th>
                            Sub Group Total
                        </th>
                        <th>
                            Group Total
                        </th>
                        <th>
                            Income
                        </th>
                        <th>
                            Sub Ledger Total
                        </th>
                        <th>
                            Ledger Total
                        </th>
                        <th>
                            Sub Group Total
                        </th>
                        <th>
                            Group Total
                        </th>
                    </tr>
                </thead>
                <tr>
                    <td colspan="5">
                        <table class="listpopup" cellspacing="0" cellpadding="0" width="100%">
                            @foreach (var EItem in expenditureHeaders.Where(x => x.ASGId == 0 && x.ASGName == null))
                            {
                                <tr>
                                    <td style="font-weight: bold">
                                        @EItem.Description
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                    </td>
                                    <td style="text-align: right; font-weight: bold">@EItem.Total
                                    </td>
                                </tr>
                                foreach (var ESubItem in expenditureHeaders.Where(x => x.Id == EItem.Id && x.ASGName != null))
                                {
                                    <tr>
                                        <td style="padding-left: 30px; font-weight: bold">
                                            @ESubItem.ASGName
                                        </td>
                                        <td>
                                        </td>
                                        <td>
                                        </td>
                                        <td style="text-align: right; font-weight: bold">@ESubItem.Total
                                        </td>
                                        <td>
                                        </td>
                                    </tr>
                                    var expenditureLedgers = KRBAccounting.Service.UtilityService.GetProfitAndLossLedgerTotals(Model.AsOnDate, "E", ESubItem.Id, ESubItem.ASGId, 0, Model.FYId, 1, 0, Model.BranchId);
                                    foreach (var ledger in expenditureLedgers)
                                    {
                                        <tr>
                                            <td style="padding-left: 45px; font-weight: bold">
                                                @ledger.AccountName
                                            </td>
                                            <td>
                                            </td>
                                            <td style="text-align: right; font-weight: bold">@ledger.Total
                                            </td>
                                            <td>
                                            </td>
                                            <td>
                                            </td>
                                        </tr>
                                        var expendituresubLedgers = KRBAccounting.Service.UtilityService.GetProfitAndLossLedgerTotals(Model.AsOnDate, "E", ESubItem.Id, ESubItem.ASGId, ledger.Id, Model.FYId, 1, 1, Model.BranchId);
                                        foreach (var subledger in expendituresubLedgers)
                                        {
                                            <tr>
                                                <td style="padding-left: 60px">
                                                    @subledger.SLName
                                                </td>
                                                <td style="text-align: right">@subledger.Total
                                                </td>
                                                <td>
                                                </td>
                                                <td>
                                                </td>
                                                <td>
                                                </td>
                                            </tr>
                                        }
                                    }
                                }
                            }
                        </table>
                    </td>
                    <td colspan="5">
                        <table class="listpopup" cellspacing="0" cellpadding="0" width="100%">
                            @foreach (var IItem in incomeHeaders.Where(x => x.ASGId == 0 && x.ASGName == null))
                            {
                                <tr>
                                    <td style="font-weight: bold">
                                        @IItem.Description
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                    </td>
                                    <td>
                                    </td>
                                    <td style="text-align: right; font-weight: bold">@IItem.Total
                                    </td>
                                </tr>
                                foreach (var ISubItem in incomeHeaders.Where(x => x.Id == IItem.Id && x.ASGName != null))
                                {
                                    <tr>
                                        <td style="padding-left: 30px; font-weight: bold">
                                            @ISubItem.ASGName
                                        </td>
                                        <td>
                                        </td>
                                         <td>
                                        </td>
                                        <td style="text-align: right; font-weight: bold">@ISubItem.Total
                                        </td>
                                        <td>
                                        </td>
                                    </tr>
                                    var incomeLedgers = KRBAccounting.Service.UtilityService.GetProfitAndLossLedgerTotals(Model.AsOnDate, "I", ISubItem.Id, ISubItem.ASGId, 0, Model.FYId, 1, 0, Model.BranchId);
                                    foreach (var ledger in incomeLedgers)
                                    {
                                        <tr>
                                            <td style="padding-left: 45px; font-weight: bold">
                                                @ledger.AccountName
                                            </td>
                                            <td>
                                            </td>
                                            <td style="text-align: right; font-weight: bold">@ledger.Total
                                            </td>
                                            <td>
                                            </td>
                                            <td>
                                            </td>
                                        </tr>
                                        var incomesubLedgers = KRBAccounting.Service.UtilityService.GetProfitAndLossLedgerTotals(Model.AsOnDate, "I", ISubItem.Id, ISubItem.ASGId, ledger.Id, Model.FYId, 1, 1, Model.BranchId);
                                        foreach (var subledger in incomesubLedgers)
                                        {
                                            <tr>
                                                <td style="padding-left: 60px">
                                                    @subledger.SLName
                                                </td>
                                                <td style="text-align: right">@subledger.Total
                                                </td>
                                                <td>
                                                </td>
                                                <td>
                                                </td>
                                                <td>
                                                </td>
                                            </tr>
                                        }
                                    }
                                }
                            }
                        </table>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: right; font-weight: bold">
                        TOTAL FOR EXPENDITURE SIDE
                    </td>
                    <td>
                    </td>
                    <td>
                    </td>
                    <td>
                    </td>
                    <td style="text-align: right; font-weight: bold">@expenditureTotal
                    </td>
                    <td style="text-align: right; font-weight: bold">
                        TOTAL FOR INCOME 
                    </td>
                    <td>
                    </td>
                    <td>
                    </td>
                    <td>
                    </td>
                    <td style="text-align: right; font-weight: bold">@incomeTotal
                    </td>
                </tr>
                if (profitLoss > 0)
                {
                    expenditureGrandTotal = expenditureTotal + profitLoss;
                    <tr>
                        <td style="text-align: right; font-weight: bold">
                            Net Profit C/F To B/S
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td style="text-align: right; font-weight: bold">@profitLoss
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td >
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                    </tr>
                }
                if (profitLoss < 0)
                {
                    var absProfitLoss = Math.Abs(profitLoss);
                    incomeGrandTotal = incomeTotal + absProfitLoss;
                    <tr>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td >
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td style="text-align: right; font-weight: bold">
                            Net Loss C/F To B/S
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td style="text-align: right; font-weight: bold">@profitLoss
                        </td>
                    </tr>
                }
                <tr>
                    <td style="text-align: right; font-weight: bold">
                        GRAND TOTAL
                    </td>
                    <td>
                    </td>
                    <td>
                    </td>
                    <td>
                    </td>
                    <td style="text-align: right; font-weight: bold">@expenditureGrandTotal
                    </td>
                    <td style="text-align: right; font-weight: bold">
                        GRAND TOTAL
                    </td>
                    <td>
                    </td>
                    <td>
                    </td>
                    <td>
                    </td>
                    <td style="text-align: right; font-weight: bold">@incomeGrandTotal
                    </td>
                </tr>
            }
        }
        else if (Model.AccountGroup == true && Model.Ledger == false)
        {
            if (Model.AccountSubGroup == true)
            {
                <thead>
                    <tr>
                        <th>
                            Expenses
                        </th>
                        <th>
                            Sub Group Total
                        </th>
                        <th>
                            Group Total
                        </th>
                        <th>
                            Income
                        </th>
                        <th>
                            Sub Group Total
                        </th>
                        <th>
                            Group Total
                        </th>
                    </tr>
                </thead>
                <tr>
                    <td colspan="3">
                        <table class="listpopup" cellspacing="0" cellpadding="0" width="100%">
                            @foreach (var EItem in expenditureHeaders.Where(x => x.ASGId == 0 && x.ASGName == null))
                            {
                                <tr>
                                    <td style="font-weight: bold">
                                        @EItem.Description
                                    </td>
                                    <td style="text-align: right">
                                    </td>
                                    <td style="text-align: right; font-weight: bold">@EItem.Total
                                    </td>
                                </tr>
                                foreach (var subgroup in expenditureHeaders.Where(x => x.Id == EItem.Id && x.ASGName != null))
                                {
                                    <tr>
                                        <td  style="padding-left: 30px">
                                            @subgroup.ASGName
                                        </td>
                                        <td style="text-align: right">@subgroup.Total
                                        </td>
                                        <td style="text-align: right">
                                        </td>
                                    </tr>
                                }
                            }
                        </table>
                    </td>
                    <td colspan="3">
                        <table class="listpopup" cellspacing="0" cellpadding="0" width="100%">
                            @foreach (var IItem in incomeHeaders.Where(x => x.ASGId == 0 && x.ASGName == null))
                            {
                                <tr>
                                    <td style="font-weight: bold">
                                        @IItem.Description
                                    </td>
                                    <td style="text-align: right">
                                    </td>
                                    <td style="text-align: right; font-weight: bold">@IItem.Total
                                    </td>
                                </tr>
                                foreach (var subgroup in incomeHeaders.Where(x => x.Id == IItem.Id && x.ASGName != null))
                                {
                                    <tr>
                                        <td  style="padding-left: 30px">
                                            @subgroup.ASGName
                                        </td>
                                         <td style="text-align: right">@subgroup.Total
                                        </td>
                                        <td style="text-align: right">
                                        </td>
                                    </tr>
                                }
                            }
                        </table>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: right; font-weight: bold">
                        TOTAL FOR EXPENDITURE 
                    </td>
                    <td style="text-align: right">
                    </td>
                    <td style="text-align: right; font-weight: bold">@expenditureTotal
                    </td>
                    <td style="text-align: right; font-weight: bold">
                        TOTAL FOR INCOME 
                    </td>
                    <td style="text-align: right">
                    </td>
                    <td style="text-align: right; font-weight: bold">@incomeTotal
                    </td>
                </tr>
                            if (profitLoss < 0)
                            {
                                var absProfitLoss = Math.Abs(profitLoss);
                                incomeGrandTotal = incomeTotal + absProfitLoss;
                    <tr>
                        <td>
                        </td>
                        <td>
                        </td>   
                        <td>
                        </td>
                        <td style="text-align: right; font-weight: bold">
                            Net Loss C/F To B/S
                        </td>
                        <td style="text-align: right">
                        </td>
                        <td style="text-align: right; font-weight: bold">@profitLoss
                        </td>
                       
                    </tr>
                            }
                            if (profitLoss > 0)
                            {
                                expenditureGrandTotal = expenditureTotal + profitLoss;
                    <tr>
                        <td style="text-align: right; font-weight: bold">
                            Net Profit C/F To B/S
                        </td>
                        <td>
                        </td>
                        <td style="text-align: right; font-weight: bold">@profitLoss
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                    </tr>
                            }
                <tr>
                    <td style="text-align: right; font-weight: bold">
                        GRAND TOTAL
                    </td>
                    <td>
                    </td>
                    <td style="text-align: right; font-weight: bold">@expenditureGrandTotal
                    </td>
                     <td style="text-align: right; font-weight: bold">
                        GRAND TOTAL
                    </td>
                    <td>
                    </td>
                    <td style="text-align: right; font-weight: bold">@incomeGrandTotal
                    </td>
                </tr>
            }
            else
            {
                <thead>
                    <tr>
                        <th>
                            Expenses   
                        </th>
                        <th>
                            Group Total
                        </th>
                        <th>
                            Income
                        </th>
                        <th>
                            Group Total
                        </th>
                    </tr>
                </thead>
                <tr>
                    <td colspan="2">
                        <table class="listpopup" cellspacing="0" cellpadding="0" width="100%">
                            @foreach (var EItem in expenditureHeaders.Where(x => x.ASGId == 0 && x.ASGName == null))
                            {
                                <tr>
                                    <td>
                                        @EItem.Description
                                    </td>
                                    <td style="text-align: right">@EItem.Total
                                    </td>
                                </tr>
                            }
                        </table>
                    </td>
                    <td colspan="2">
                        <table class="listpopup" cellspacing="0" cellpadding="0" width="100%">
                            @foreach (var IItem in incomeHeaders.Where(x => x.ASGId == 0 && x.ASGName == null))
                            {
                                <tr>
                                    <td>
                                        @IItem.Description
                                    </td>
                                    <td style="text-align: right">@IItem.Total
                                    </td>
                                </tr>
                            }
                        </table>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: right; font-weight: bold">
                        TOTAL FOR EXPENDITURE 
                    </td>
                    <td style="text-align: right; font-weight: bold">@expenditureTotal
                    </td>
                    <td style="text-align: right; font-weight: bold">
                        TOTAL FOR INCOME 
                    </td>
                    <td style="text-align: right; font-weight: bold">@incomeTotal
                    </td>
                </tr>
                            
                            if (profitLoss < 0)
                            {
                                var absProfitLoss = Math.Abs(profitLoss);
                                incomeGrandTotal = incomeTotal + absProfitLoss;
                    <tr>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td style="text-align: right; font-weight: bold">
                            Net Loss C/F To B/S
                        </td>
                        <td style="text-align: right; font-weight: bold">@profitLoss
                        </td>
                       
                    </tr>
                            }
                            if (profitLoss > 0)
                            {
                                expenditureGrandTotal = expenditureTotal + profitLoss;
                    <tr>
                        <td style="text-align: right; font-weight: bold">
                            Net Profit C/F To B/S
                        </td>
                        <td style="text-align: right; font-weight: bold">@profitLoss
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                    </tr>
                            }
                <tr>
                    <td style="text-align: right; font-weight: bold">
                        GRAND TOTAL
                    </td>
                    <td style="text-align: right; font-weight: bold">@expenditureGrandTotal
                    </td>
                     <td style="text-align: right; font-weight: bold">
                        GRAND TOTAL
                    </td>
                    <td style="text-align: right; font-weight: bold">@incomeGrandTotal
                    </td>
                </tr>
            }
        }
          @if (Model.AccountGroup == false && Model.Ledger == true)
          {
              if (Model.Subledger == true)
              {
                  <thead>
                      <tr>
                          <th>
                              Expense
                          </th>
                          <th>
                              Sub Ledger Total
                          </th>
                          <th>
                              Ledger Total
                          </th>
                          <th>
                              Income
                          </th>
                          <th>
                              Sub Ledger Total
                          </th>
                          <th>
                              Ledger Total
                          </th>
                      </tr>
                  </thead>
                  <tr>
                      <td colspan="3">
                          <table class="listpopup" cellspacing="0" cellpadding="0" width="100%">
                            @foreach (var item in expenditureHeaders.Where(x => x.ASGId == 0 && x.ASGName == null))
                            {
                                var expenditureLedgers = KRBAccounting.Service.UtilityService.GetProfitAndLossLedgerTotals(Model.AsOnDate, "E", item.Id, 0, 0, Model.FYId, 0, 1, Model.BranchId);
                                foreach (var ledger in expenditureLedgers)
                                {
                                    if (ledger.SLName == null)
                                    {
                                        <tr>
                                            <td>
                                                @ledger.AccountName
                                            </td>
                                            <td>
                                            </td>
                                            <td style="text-align: right">@ledger.Total
                                            </td>
                                        </tr>
                                    }
                                    else if (ledger.SLName != null)
                                    {
                                        <tr>
                                            <td style="padding-left: 30px">
                                                @ledger.SLName
                                            </td>
                                            <td style="text-align: right">@ledger.Total
                                            </td>
                                            <td>
                                            </td>
                                        </tr>
                                    }
                                }
                            }  
                          </table>
                      </td>
                      <td colspan="3">
                          <table class="listpopup" cellspacing="0" cellpadding="0" width="100%">
                              @foreach (var IItem in incomeHeaders.Where(x => x.ASGId == 0 && x.ASGName == null))
                              {
                                  var incomeLedgers = KRBAccounting.Service.UtilityService.GetProfitAndLossLedgerTotals(Model.AsOnDate, "I", IItem.Id, 0, 0, Model.FYId, 0, 1, Model.BranchId);
                                  foreach (var ledger in incomeLedgers)
                                  {
                                      if (ledger.SLName == null)
                                      {
                                            <tr>
                                                <td>
                                                    @ledger.AccountName
                                                </td>
                                                 <td>
                                                </td>
                                                <td style="text-align: right">@ledger.Total
                                                </td>
                                            </tr>
                                      }
                                      else if (ledger.SLName != null)
                                      {
                                            <tr>
                                                <td style="padding-left: 40px">
                                                    @ledger.SLName
                                                </td>
                                                <td style="text-align: right">@ledger.Total
                                                </td>
                                                <td>
                                                </td>
                                            </tr>
                                      }
                                  }
                              }
                          </table>
                      </td>
                  </tr>
                  <tr>
                      <td style="text-align: right; font-weight: bold">
                          TOTAL FOR EXPENDITURE SIDE
                      </td>
                      <td></td>
                      <td style="text-align: right; font-weight: bold">@expenditureTotal
                      </td>
                      <td style="text-align: right; font-weight: bold">
                          TOTAL FOR INCOME 
                      </td>
                      <td></td>
                      <td style="text-align: right; font-weight: bold">@incomeTotal
                      </td>
                  </tr>
                              if (profitLoss > 0)
                              {
                                  expenditureGrandTotal = expenditureTotal + profitLoss;
                      <tr>
                          <td style="text-align: right; font-weight: bold">
                              Net Profit C/F To B/S
                          </td>
                          <td></td>
                          <td style="text-align: right; font-weight: bold">@profitLoss
                          </td>
                          <td>
                          </td>
                          <td>
                          </td>
                          <td></td>
                      </tr>
                              }
                              if (profitLoss < 0)
                              {
                                  var absProfitLoss = Math.Abs(profitLoss);
                                  incomeGrandTotal = incomeTotal + absProfitLoss;
                      <tr>
                          <td>
                          </td>
                          <td>
                          </td>
                          <td></td>
                          <td style="text-align: right; font-weight: bold">
                              Net Loss C/F To B/S
                          </td>
                          <td></td>
                          <td style="text-align: right; font-weight: bold">@profitLoss
                          </td>
                      </tr>
                              }
                  <tr>
                      <td style="text-align: right; font-weight: bold">
                          GRAND TOTAL
                      </td>
                      <td></td>
                      <td style="text-align: right; font-weight: bold">@expenditureGrandTotal
                      </td>
                      <td style="text-align: right; font-weight: bold">
                          GRAND TOTAL
                      </td>
                      <td></td>
                      <td style="text-align: right; font-weight: bold">@incomeGrandTotal
                      </td>
                  </tr>
              }
              else
              {
                 <thead>
                      <tr>
                          <th>
                              Expense
                          </th>
                          <th>
                              Ledger Total
                          </th>
                          <th>
                              Income
                          </th>
                          <th>
                              Ledger Total
                          </th>
                      </tr>
                  </thead>
                  <tr>
                      <td colspan="2">
                          <table class="listpopup" cellspacing="0" cellpadding="0" width="100%">
                              @foreach (var EItem in expenditureHeaders.Where(x => x.ASGId == 0 && x.ASGName == null))
                              {
                                  var expenditureLedgers = KRBAccounting.Service.UtilityService.GetProfitAndLossLedgerTotals(Model.AsOnDate, "E", EItem.Id, 0, 0, Model.FYId, 0, 0, Model.BranchId);
                                  foreach (var Eledger in expenditureLedgers)
                                  {
                                      <tr>
                                          <td>
                                              @Eledger.AccountName
                                          </td>
                                          <td style="text-align: right">@Eledger.Total
                                          </td>
                                      </tr>
                                  }
                              }
                          </table>
                      </td>
                      <td colspan="2">
                          <table class="listpopup" cellspacing="0" cellpadding="0" width="100%">
                              @foreach (var IItem in incomeHeaders.Where(x => x.ASGId == 0 && x.ASGName == null))
                              {
                                  var incomeLedgers = KRBAccounting.Service.UtilityService.GetProfitAndLossLedgerTotals(Model.AsOnDate, "I", IItem.Id, 0, 0, Model.FYId, 0, 0, Model.BranchId);
                                  foreach (var Iledger in incomeLedgers)
                                  {
                                      <tr>
                                          <td>
                                              @Iledger.AccountName
                                          </td>
                                          <td style="text-align: right">@Iledger.Total
                                          </td>
                                      </tr>
                                  }
                              }
                          </table>
                      </td>
                  </tr>
                  <tr>
                      <td style="text-align: right; font-weight: bold">
                          TOTAL FOR EXPENDITURE SIDE
                      </td>
                      <td style="text-align: right; font-weight: bold">@expenditureTotal
                      </td>
                      <td style="text-align: right; font-weight: bold">
                          TOTAL FOR INCOME 
                      </td>
                      <td style="text-align: right; font-weight: bold">@incomeTotal
                      </td>
                  </tr>
                              if (profitLoss > 0)
                              {
                                  expenditureGrandTotal = expenditureTotal + profitLoss;
                      <tr>
                          <td style="text-align: right; font-weight: bold">
                              Net Profit C/F To B/S
                          </td>
                          <td style="text-align: right; font-weight: bold">@profitLoss
                          </td>
                          <td>
                          </td>
                          <td>
                          </td>
                      </tr>
                              }
                              if (profitLoss < 0)
                              {
                                  var absProfitLoss = Math.Abs(profitLoss);
                                  incomeGrandTotal = incomeTotal + absProfitLoss;
                      <tr>
                          <td>
                          </td>
                          <td>
                          </td>
                          <td style="text-align: right; font-weight: bold">
                              Net Loss C/F To B/S
                          </td>
                          <td style="text-align: right; font-weight: bold">@profitLoss
                          </td>
                      </tr>
                              }
                  <tr>
                      <td style="text-align: right; font-weight: bold">
                          GRAND TOTAL
                      </td>
                      <td style="text-align: right; font-weight: bold">@expenditureGrandTotal
                      </td>
                      <td style="text-align: right; font-weight: bold">
                          GRAND TOTAL
                      </td>
                      <td style="text-align: right; font-weight: bold">@incomeGrandTotal
                      </td>
                
                  </tr>
              }
          }
    </table>
</div>
